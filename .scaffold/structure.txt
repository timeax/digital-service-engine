src/
  core/
    tag-relations.ts
    validate/
      index.ts
      shared.ts
      steps/
        structure.ts
        identity.ts
        option-maps.ts
        visibility.ts
        service-vs-input.ts
        utility.ts
        rates.ts
        constraints.ts
        custom.ts
        global-utility-guard.ts
        unbound.ts
        fallbacks.ts
      policies/
        where.ts
        collect-service-items.ts
        ops.ts
        apply-policies.ts
  react/
    inputs/
      entries/
        shared.ts
        text.tsx
        textarea.tsx
        number.tsx
        select.tsx
        multiselect.tsx
        checkbox.tsx
        toggle.tsx
        radio.tsx
        chips.tsx
        treeselect.tsx
        date.tsx
        file.tsx
        color.tsx
        phone.tsx
        password.tsx
        keyvalue.tsx
        custom.tsx
        slider.tsx
        toggle-group.tsx
        json-editor.tsx
        lister.tsx
        icon.tsx
        image-icon.tsx
    workspace/
      context/
        backend.ts                     # backend contracts
        context.tsx                    # CanvasProvider currently imports workspace from "."
        ctxmenu.tsx
        memory/
          index.ts                    # exports createMemoryWorkspaceBackend, types
          memory-backend.ts           # main implementation (WorkspaceBackend)
          store.ts                    # in-memory store shape + helpers
          ids.ts                      # id generators (thread/message/branch/template/commit/draft)
          time.ts                     # now()/iso() helpers
          errors.ts
          seed.ts
        provider/
          provider.tsx                 # will be refactored into thin composition root
          context.ts                   # WorkspaceContext + hooks (useWorkspace/useWorkspaceMaybe)
          helpers.ts                   # shared helpers (may shrink / be partially moved)
          types.ts                     # shared types (may shrink as slices own their types)

          # NEW (for the hook-slice refactor)
          runtime/
            use-backend-runtime.ts     # call/runTasks/toBackendError/live + small utilities

          slices/
            use-authors-slice.ts       # authors state + load/refresh
            use-permissions-slice.ts   # permissions state + load/refresh
            use-branches-slice.ts      # branches state + setCurrentBranch + load/refresh
            use-templates-slice.ts     # templates (branch-scoped) state + load/refresh
            use-services-slice.ts      # services state + load/refresh
            use-snapshots-slice.ts     # snapshots (branch-scoped) state + load/save/autosave/publish/discard/refresh pointers
            use-comments-slice.ts

          compose/
            use-workspace-refresh.ts   # refreshAll + refreshBranchContext orchestration
            use-live-polling.ts        # live-mode polling loop wrapper (optional)
            use-branch-cache.ts        # branch cache helper (optional)
          live/
            types.ts                         # Live adapter contracts + context types
            adapters/
              poll.ts                        # current polling logic, extracted cleanly
              manual.ts                      # (optional) dev/test adapter
              ws.ts                          # (optional stub) host can implement too
              sse.ts