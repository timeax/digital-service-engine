{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/AdminPolicies",
  "definitions": {
    "AdminPolicies": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/DynamicRule"
      },
      "description": "Exported alias so the schema generator can target an array"
    },
    "DynamicRule": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "scope": {
          "type": "string",
          "enum": [
            "global",
            "visible_group"
          ]
        },
        "subject": {
          "type": "string",
          "const": "services"
        },
        "filter": {
          "type": "object",
          "properties": {
            "role": {
              "type": "string",
              "enum": [
                "base",
                "utility",
                "both"
              ]
            },
            "tag_id": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              ]
            },
            "field_id": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              ]
            },
            "where": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/ServiceWhereClause"
              }
            }
          },
          "description": "Package-level filter surface:\n- role/tag/field are core to the builder schema\n- where[] allows hosts to filter against extra service properties (handler_id/platform_id/type/key/category_id/etc.)"
        },
        "projection": {
          "type": "string",
          "description": "Projection is intentionally open: hosts may project custom service properties."
        },
        "op": {
          "type": "string",
          "enum": [
            "all_equal",
            "unique",
            "no_mix",
            "all_true",
            "any_true",
            "max_count",
            "min_count"
          ]
        },
        "value": {
          "type": [
            "number",
            "boolean"
          ]
        },
        "severity": {
          "type": "string",
          "enum": [
            "error",
            "warning"
          ]
        },
        "message": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "scope",
        "subject",
        "op"
      ]
    },
    "ServiceWhereClause": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string"
        },
        "op": {
          "$ref": "#/definitions/ServiceWhereOp"
        },
        "value": {}
      },
      "required": [
        "path"
      ],
      "description": "Host-extensible service filter clause. `path` should usually be \"service.<prop>\" or \"service.meta.<prop>\" etc."
    },
    "ServiceWhereOp": {
      "type": "string",
      "enum": [
        "eq",
        "neq",
        "in",
        "nin",
        "exists",
        "truthy",
        "falsy",
        "sw"
      ]
    }
  }
}